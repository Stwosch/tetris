(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const vector_1 = require("../vector");
class Block {
    constructor() { }
    getBlockPosition(startPosition) {
        return this._vectors.map((vector) => vector.plus(startPosition));
    }
    get type() {
        return this._type;
    }
    get width() {
        return this._width;
    }
    set vectors(vectors) {
        this._vectors = vectors;
    }
    get vectors() {
        return this._vectors;
    }
}
exports.Block = Block;
class EmptyBlock extends Block {
    constructor() {
        super();
        this._type = 'empty';
    }
}
exports.EmptyBlock = EmptyBlock;
class OBlock extends Block {
    constructor() {
        super();
        this._type = 'o';
        this._vectors = [
            new vector_1.Vector(0, 0),
            new vector_1.Vector(1, 0),
            new vector_1.Vector(0, 1),
            new vector_1.Vector(1, 1)
        ];
        this._width = 2;
        this._height = 2;
    }
}
exports.OBlock = OBlock;
},{"../vector":8}],2:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const useful_functions_1 = require("../useful-functions");
const block_1 = require("../block");
const vector_1 = require("../vector");
class Board {
    constructor(width, height) {
        this._width = width;
        this._height = height;
    }
    get width() {
        return this._width;
    }
    set width(width) {
        this._width = width;
    }
    get height() {
        return this._height;
    }
    set height(height) {
        this._height = height;
    }
    get area() {
        return this._area;
    }
    setAreaBlock(vector, block) {
        this._area[vector.y][vector.x].value = block;
    }
    initArea() {
        this._area = [];
        useful_functions_1.times(this._height, (y) => {
            this._area.push([]);
            useful_functions_1.times(this._width, (x) => {
                const id = new vector_1.Vector(x, y).getId();
                this._area[y].push({
                    value: new block_1.EmptyBlock,
                    id: id
                });
            });
        });
    }
}
exports.Board = Board;
},{"../block":1,"../useful-functions":7,"../vector":8}],3:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const board_1 = require("../board");
const vector_1 = require("../vector");
class Controller {
    constructor(model, view) {
        this._model = model;
        this._view = view;
        this._createdBlock = false;
    }
    _tryMoveBlock(block, move) {
        if (this._model.canDropBlock(block.vectors, move)) {
            const oldVectors = block.vectors;
            block.vectors = block.getBlockPosition(move);
            this._model.removeBlock(oldVectors);
            this._model.addBlock(block);
            this._view.removeBlock(oldVectors);
            this._view.renderBlock(block);
        }
        else if (move.y > 0) {
            this._createdBlock = false;
        }
    }
    _createBlock() {
        const block = this._model.createBlock();
        if (block.vectors.length > 0) {
            this._view.renderBlock(block);
            this._createdBlock = true;
            return block;
        }
        //konczymy gre, nie mozemy utworzyc nowego bloku, gdy length jest rowna 0
    }
    _startGame() {
        let block;
        window.addEventListener('keydown', e => {
            if (block) {
                switch (e.keyCode) {
                    case 37:
                        this._tryMoveBlock(block, new vector_1.Vector(-1, 0));
                        break;
                    case 39:
                        this._tryMoveBlock(block, new vector_1.Vector(1, 0));
                        break;
                }
            }
        });
        return setInterval(() => {
            if (this._createdBlock) {
                this._tryMoveBlock(block, new vector_1.Vector(0, 1));
            }
            else {
                block = this._createBlock();
            }
        }, 500);
    }
    init() {
        const board = new board_1.Board(10, 20);
        this._model.saveBoard(board);
        this._view.renderEmptyTemplate(board.area);
        const run = this._startGame();
    }
}
exports.Controller = Controller;
},{"../board":2,"../vector":8}],4:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.DOM = {
    blockTmpl: Handlebars.compile(document.getElementById('block-template').innerHTML),
    board: document.querySelector('.board')
};
},{}],5:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const model_1 = require("./model");
const view_1 = require("./view");
const controller_1 = require("./controller");
const controller = new controller_1.Controller(new model_1.Model, new view_1.View);
controller.init();
},{"./controller":3,"./model":6,"./view":9}],6:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const block_1 = require("../block");
const vector_1 = require("../vector");
const useful_functions_1 = require("../useful-functions");
class Model {
    constructor() { }
    _checkVectorFitArray(array, vector) {
        return vector.y < array.length && vector.y >= 0 && vector.x >= 0 && vector.x < array[0].length;
    }
    _checkIsPositionFree(positions) {
        const typeOfEmptyBlock = new block_1.EmptyBlock().type;
        const index = positions.findIndex((vector) => {
            if (this._checkVectorFitArray(this._board.area, vector)) {
                return this._board.area[vector.y][vector.x].value.type !== typeOfEmptyBlock;
            }
            else {
                return true;
            }
        });
        return index === -1;
    }
    _checkFreeSpaces(block) {
        const spaces = [];
        const amountSpacesToCheck = this._board.area[0].length - Math.floor(block.width / 2);
        useful_functions_1.times(amountSpacesToCheck, (x) => {
            const areaVectors = block.getBlockPosition(new vector_1.Vector(x, 0));
            if (this._checkIsPositionFree(areaVectors)) {
                spaces.push(areaVectors);
            }
        });
        return spaces;
    }
    _randomValueFromArray(array) {
        return array[Math.floor(Math.random() * array.length)];
    }
    _saveBlock(block) {
        const spaces = this._checkFreeSpaces(block);
        if (spaces.length <= 0) {
            block.vectors = [];
            return;
        }
        block.vectors = this._randomValueFromArray(spaces);
        this.addBlock(block);
    }
    _filterProperVectorToMoveDown(properVectors, vector) {
        const pVectorIndex = properVectors.findIndex((pVector) => pVector.x === vector.x);
        if (pVectorIndex === -1) {
            properVectors.push(new vector_1.Vector(vector.x, vector.y));
        }
        else if (properVectors[pVectorIndex].y < vector.y) {
            properVectors[pVectorIndex].y = vector.y;
        }
    }
    _filterProperVectorToMoveRight(properVectors, vector) {
        const pVectorIndex = properVectors.findIndex((pVector) => pVector.y === vector.y);
        if (pVectorIndex === -1) {
            properVectors.push(new vector_1.Vector(vector.x, vector.y));
        }
        else if (properVectors[pVectorIndex].x < vector.x) {
            properVectors[pVectorIndex].x = vector.x;
        }
    }
    _filterProperVectorToMoveLeft(properVectors, vector) {
        const pVectorIndex = properVectors.findIndex((pVector) => pVector.y === vector.y);
        if (pVectorIndex === -1) {
            properVectors.push(new vector_1.Vector(vector.x, vector.y));
        }
        else if (properVectors[pVectorIndex].x > vector.x) {
            properVectors[pVectorIndex].x = vector.x;
        }
    }
    _filterProperVectorToMove(properVectors, vector, move) {
        if (move.y === 1) {
            this._filterProperVectorToMoveDown(properVectors, vector);
        }
        else if (move.x === 1) {
            this._filterProperVectorToMoveRight(properVectors, vector);
        }
        else if (move.x === -1) {
            this._filterProperVectorToMoveLeft(properVectors, vector);
        }
    }
    saveBoard(board) {
        this._board = board;
        this._board.initArea();
        this._blocks = [
            new block_1.OBlock
        ];
    }
    createBlock() {
        const blockSource = this._randomValueFromArray(this._blocks);
        const block = Object.assign(new block_1.Block, blockSource);
        this._saveBlock(block);
        return block;
    }
    canDropBlock(positions, move) {
        const properVectors = [];
        positions.forEach((vector) => this._filterProperVectorToMove(properVectors, vector, move));
        const droppedVectors = properVectors.map((vector) => vector.plus(move));
        return this._checkIsPositionFree(droppedVectors);
    }
    removeBlock(vectors) {
        vectors.forEach((vector) => this._board.setAreaBlock(vector, new block_1.EmptyBlock));
    }
    addBlock(block) {
        block.vectors.forEach((vector) => this._board.setAreaBlock(vector, block));
    }
}
exports.Model = Model;
},{"../block":1,"../useful-functions":7,"../vector":8}],7:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
function times(times, fn) {
    let output = "";
    for (let i = 0; i < times; i++) {
        output += fn(i);
    }
    return output;
}
exports.times = times;
},{}],8:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
class Vector {
    constructor(x, y) {
        this._x = x;
        this._y = y;
    }
    get x() {
        return this._x;
    }
    get y() {
        return this._y;
    }
    set x(x) {
        this._x = x;
    }
    set y(y) {
        this._y = y;
    }
    plus(vector) {
        return new Vector(this._x + vector.x, this._y + vector.y);
    }
    getId() {
        return parseInt(this._y.toString() + this._x.toString());
    }
}
exports.Vector = Vector;
},{}],9:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const dom_elements_1 = require("../dom-elements");
const block_1 = require("../block");
class View {
    constructor() {
    }
    _getBlockById(id) {
        return document.getElementById('bid-' + id);
    }
    _addTypeToBlock(el, type) {
        el.className = "block block__" + type;
    }
    renderEmptyTemplate(area) {
        const flattened = area.reduce((sum, value) => sum.concat(value), []);
        const output = flattened.reduce((html, block) => html += dom_elements_1.DOM.blockTmpl({
            type: block.value.type,
            id: block.id
        }), "");
        dom_elements_1.DOM.board.innerHTML = output;
    }
    renderBlock(block) {
        block.vectors.forEach((vector) => {
            const id = vector.getId();
            const el = this._getBlockById(id);
            this._addTypeToBlock(el, block.type);
        });
    }
    removeBlock(vectors) {
        const typeOfEmptyBlock = new block_1.EmptyBlock().type;
        vectors.forEach((vector) => {
            const id = vector.getId();
            const el = this._getBlockById(id);
            this._addTypeToBlock(el, typeOfEmptyBlock);
        });
    }
}
exports.View = View;
},{"../block":1,"../dom-elements":4}]},{},[3,6,9,5,2,4,7,1,8])
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJzb3VyY2UvdHMvYmxvY2svaW5kZXgudHMiLCJzb3VyY2UvdHMvYm9hcmQvaW5kZXgudHMiLCJzb3VyY2UvdHMvY29udHJvbGxlci9pbmRleC50cyIsInNvdXJjZS90cy9kb20tZWxlbWVudHMvaW5kZXgudHMiLCJzb3VyY2UvdHMvbWFpbi50cyIsInNvdXJjZS90cy9tb2RlbC9pbmRleC50cyIsInNvdXJjZS90cy91c2VmdWwtZnVuY3Rpb25zL2luZGV4LnRzIiwic291cmNlL3RzL3ZlY3Rvci9pbmRleC50cyIsInNvdXJjZS90cy92aWV3L2luZGV4LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBOzs7QUNBQSxzQ0FBbUM7QUFFbkM7SUFPSSxnQkFBZSxDQUFDO0lBRWhCLGdCQUFnQixDQUFDLGFBQXFCO1FBQ2xDLE1BQU0sQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLEdBQUcsQ0FBQyxDQUFDLE1BQWMsS0FBSyxNQUFNLENBQUMsSUFBSSxDQUFDLGFBQWEsQ0FBQyxDQUFDLENBQUM7SUFDN0UsQ0FBQztJQUVELElBQUksSUFBSTtRQUNKLE1BQU0sQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDO0lBQ3RCLENBQUM7SUFFRCxJQUFJLEtBQUs7UUFDTCxNQUFNLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQztJQUN2QixDQUFDO0lBRUQsSUFBSSxPQUFPLENBQUMsT0FBaUI7UUFDekIsSUFBSSxDQUFDLFFBQVEsR0FBRyxPQUFPLENBQUM7SUFDNUIsQ0FBQztJQUVELElBQUksT0FBTztRQUNQLE1BQU0sQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDO0lBQ3pCLENBQUM7Q0FDSjtBQTVCRCxzQkE0QkM7QUFFRCxnQkFBd0IsU0FBUSxLQUFLO0lBRWpDO1FBQ0ksS0FBSyxFQUFFLENBQUM7UUFFUixJQUFJLENBQUMsS0FBSyxHQUFHLE9BQU8sQ0FBQztJQUN6QixDQUFDO0NBQ0o7QUFQ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O0lBRUQsV0FBVyxDQUFDLEtBQVk7UUFFcEIsS0FBSyxDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsQ0FBQyxNQUFjO1lBRWpDLE1BQU0sRUFBRSxHQUFHLE1BQU0sQ0FBQyxLQUFLLEVBQUUsQ0FBQztZQUMxQixNQUFNLEVBQUUsR0FBRyxJQUFJLENBQUMsYUFBYSxDQUFDLEVBQUUsQ0FBQyxDQUFDO1lBQ2xDLElBQUksQ0FBQyxlQUFlLENBQUMsRUFBRSxFQUFFLEtBQUssQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUN6QyxDQUFDLENBQUMsQ0FBQztJQUNQLENBQUM7SUFFRCxXQUFXLENBQUMsT0FBaUI7UUFFekIsTUFBTSxnQkFBZ0IsR0FBRyxJQUFJLGtCQUFVLEVBQUUsQ0FBQyxJQUFJLENBQUM7UUFFL0MsT0FBTyxDQUFDLE9BQU8sQ0FBQyxDQUFDLE1BQWM7WUFFM0IsTUFBTSxFQUFFLEdBQUcsTUFBTSxDQUFDLEtBQUssRUFBRSxDQUFDO1lBQzFCLE1BQU0sRUFBRSxHQUFHLElBQUksQ0FBQyxhQUFhLENBQUMsRUFBRSxDQUFDLENBQUM7WUFDbEMsSUFBSSxDQUFDLGVBQWUsQ0FBQyxFQUFFLEVBQUUsZ0JBQWdCLENBQUMsQ0FBQztRQUUvQyxDQUFDLENBQUMsQ0FBQztJQUNQLENBQUM7Q0FDSjtBQXpERCxvQkF5REMiLCJmaWxlIjoiZ2VuZXJhdGVkLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbiBlKHQsbixyKXtmdW5jdGlvbiBzKG8sdSl7aWYoIW5bb10pe2lmKCF0W29dKXt2YXIgYT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2lmKCF1JiZhKXJldHVybiBhKG8sITApO2lmKGkpcmV0dXJuIGkobywhMCk7dmFyIGY9bmV3IEVycm9yKFwiQ2Fubm90IGZpbmQgbW9kdWxlICdcIitvK1wiJ1wiKTt0aHJvdyBmLmNvZGU9XCJNT0RVTEVfTk9UX0ZPVU5EXCIsZn12YXIgbD1uW29dPXtleHBvcnRzOnt9fTt0W29dWzBdLmNhbGwobC5leHBvcnRzLGZ1bmN0aW9uKGUpe3ZhciBuPXRbb11bMV1bZV07cmV0dXJuIHMobj9uOmUpfSxsLGwuZXhwb3J0cyxlLHQsbixyKX1yZXR1cm4gbltvXS5leHBvcnRzfXZhciBpPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7Zm9yKHZhciBvPTA7bzxyLmxlbmd0aDtvKyspcyhyW29dKTtyZXR1cm4gc30pIiwiaW1wb3J0IHsgVmVjdG9yIH0gZnJvbSAnLi4vdmVjdG9yJztcclxuXHJcbmV4cG9ydCBjbGFzcyBCbG9jayB7XHJcblxyXG4gICAgcHJvdGVjdGVkIF92ZWN0b3JzOiBWZWN0b3JbXTtcclxuICAgIHByb3RlY3RlZCBfdHlwZTogc3RyaW5nO1xyXG4gICAgcHJvdGVjdGVkIF93aWR0aDogbnVtYmVyO1xyXG4gICAgcHJvdGVjdGVkIF9oZWlnaHQ6IG51bWJlcjtcclxuXHJcbiAgICBjb25zdHJ1Y3RvcigpIHt9XHJcblxyXG4gICAgZ2V0QmxvY2tQb3NpdGlvbihzdGFydFBvc2l0aW9uOiBWZWN0b3IpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fdmVjdG9ycy5tYXAoKHZlY3RvcjogVmVjdG9yKSA9PiB2ZWN0b3IucGx1cyhzdGFydFBvc2l0aW9uKSk7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0IHR5cGUoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX3R5cGU7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0IHdpZHRoKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl93aWR0aDtcclxuICAgIH1cclxuXHJcbiAgICBzZXQgdmVjdG9ycyh2ZWN0b3JzOiBWZWN0b3JbXSkge1xyXG4gICAgICAgIHRoaXMuX3ZlY3RvcnMgPSB2ZWN0b3JzO1xyXG4gICAgfVxyXG5cclxuICAgIGdldCB2ZWN0b3JzKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl92ZWN0b3JzO1xyXG4gICAgfVxyXG59XHJcblxyXG5leHBvcnQgY2xhc3MgRW1wdHlCbG9jayBleHRlbmRzIEJsb2NrIHtcclxuXHJcbiAgICBjb25zdHJ1Y3RvcigpIHtcclxuICAgICAgICBzdXBlcigpO1xyXG5cclxuICAgICAgICB0aGlzLl90eXBlID0gJ2VtcHR5JztcclxuICAgIH1cclxufVxyXG5cclxuZXhwb3J0IGNsYXNzIE9CbG9jayBleHRlbmRzIEJsb2NrIHtcclxuXHJcbiAgICBjb25zdHJ1Y3RvcigpIHtcclxuICAgICAgICBzdXBlcigpO1xyXG5cclxuICAgICAgICB0aGlzLl90eXBlID0gJ28nO1xyXG4gICAgICAgIHRoaXMuX3ZlY3RvcnMgPSBbXHJcbiAgICAgICAgICAgIG5ldyBWZWN0b3IoMCwgMCksXHJcbiAgICAgICAgICAgIG5ldyBWZWN0b3IoMSwgMCksXHJcbiAgICAgICAgICAgIG5ldyBWZWN0b3IoMCwgMSksXHJcbiAgICAgICAgICAgIG5ldyBWZWN0b3IoMSwgMSlcclxuICAgICAgICBdXHJcblxyXG4gICAgICAgIHRoaXMuX3dpZHRoID0gMjtcclxuICAgICAgICB0aGlzLl9oZWlnaHQgPSAyO1xyXG4gICAgfVxyXG59IiwiaW1wb3J0IHsgdGltZXMgfSBmcm9tICcuLi91c2VmdWwtZnVuY3Rpb25zJztcclxuaW1wb3J0IHsgRW1wdHlCbG9jaywgQmxvY2sgfSBmcm9tICcuLi9ibG9jayc7XHJcbmltcG9ydCB7IFZlY3RvciB9IGZyb20gJy4uL3ZlY3Rvcic7XHJcblxyXG5leHBvcnQgY2xhc3MgQm9hcmQge1xyXG4gICAgXHJcbiAgICBwcml2YXRlIF93aWR0aDogbnVtYmVyO1xyXG4gICAgcHJpdmF0ZSBfaGVpZ2h0OiBudW1iZXI7XHJcbiAgICBwcml2YXRlIF9hcmVhOiB7dmFsdWU6IEJsb2NrLCBpZDogbnVtYmVyfVtdW107XHJcblxyXG4gICAgY29uc3RydWN0b3Iod2lkdGg6IG51bWJlciwgaGVpZ2h0OiBudW1iZXIpIHtcclxuICAgICAgICB0aGlzLl93aWR0aCA9IHdpZHRoO1xyXG4gICAgICAgIHRoaXMuX2hlaWdodCA9IGhlaWdodDtcclxuICAgIH1cclxuXHJcbiAgICBnZXQgd2lkdGgoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX3dpZHRoO1xyXG4gICAgfVxyXG5cclxuICAgIHNldCB3aWR0aCh3aWR0aDogbnVtYmVyKSB7XHJcbiAgICAgICB0aGlzLl93aWR0aCA9IHdpZHRoO1xyXG4gICAgfVxyXG5cclxuICAgIGdldCBoZWlnaHQoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX2hlaWdodDtcclxuICAgIH1cclxuXHJcbiAgICBzZXQgaGVpZ2h0KGhlaWdodDogbnVtYmVyKSB7XHJcbiAgICAgICAgdGhpcy5faGVpZ2h0ID0gaGVpZ2h0XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0IGFyZWEoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX2FyZWE7XHJcbiAgICB9XHJcblxyXG4gICAgc2V0QXJlYUJsb2NrKHZlY3RvcjogVmVjdG9yLCBibG9jazogQmxvY2spIHtcclxuICAgICAgICB0aGlzLl9hcmVhW3ZlY3Rvci55XVt2ZWN0b3IueF0udmFsdWUgPSBibG9jazsgXHJcbiAgICB9XHJcblxyXG4gICAgaW5pdEFyZWEoKSB7XHJcbiAgICAgICAgXHJcbiAgICAgICAgdGhpcy5fYXJlYSA9IFtdO1xyXG4gICAgICAgIFxyXG4gICAgICAgIHRpbWVzKHRoaXMuX2hlaWdodCwgKHk6IG51bWJlcikgPT4ge1xyXG5cclxuICAgICAgICAgICAgdGhpcy5fYXJlYS5wdXNoKFtdKTtcclxuICAgICAgICAgICAgdGltZXModGhpcy5fd2lkdGgsICh4OiBudW1iZXIpID0+IHtcclxuXHJcbiAgICAgICAgICAgICAgICBjb25zdCBpZDogbnVtYmVyID0gbmV3IFZlY3Rvcih4LCB5KS5nZXRJZCgpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5fYXJlYVt5XS5wdXNoKHtcclxuICAgICAgICAgICAgICAgICAgIHZhbHVlOiBuZXcgRW1wdHlCbG9jayxcclxuICAgICAgICAgICAgICAgICAgIGlkOiBpZCBcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbiAgICBcclxufSIsImltcG9ydCB7IE1vZGVsIH0gZnJvbSAnLi4vbW9kZWwnO1xyXG5pbXBvcnQgeyBWaWV3IH0gZnJvbSAnLi4vdmlldyc7XHJcbmltcG9ydCB7IEJvYXJkIH0gZnJvbSAnLi4vYm9hcmQnO1xyXG5pbXBvcnQgeyBCbG9jayB9IGZyb20gJy4uL2Jsb2NrJztcclxuaW1wb3J0IHsgVmVjdG9yIH0gZnJvbSAnLi4vdmVjdG9yJztcclxuXHJcbmV4cG9ydCBjbGFzcyBDb250cm9sbGVyIHtcclxuXHJcbiAgICBwcml2YXRlIF9tb2RlbDogTW9kZWw7XHJcbiAgICBwcml2YXRlIF92aWV3OiBWaWV3O1xyXG4gICAgcHJpdmF0ZSBfY3JlYXRlZEJsb2NrOiBib29sZWFuO1xyXG5cclxuICAgIGNvbnN0cnVjdG9yKG1vZGVsOiBNb2RlbCwgdmlldzogVmlldykge1xyXG4gICAgICAgIHRoaXMuX21vZGVsID0gbW9kZWw7XHJcbiAgICAgICAgdGhpcy5fdmlldyA9IHZpZXc7XHJcbiAgICAgICAgdGhpcy5fY3JlYXRlZEJsb2NrID0gZmFsc2U7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBfdHJ5TW92ZUJsb2NrKGJsb2NrOiBCbG9jaywgbW92ZTogVmVjdG9yKSB7XHJcbiAgICAgICAgXHJcbiAgICAgICAgaWYodGhpcy5fbW9kZWwuY2FuRHJvcEJsb2NrKGJsb2NrLnZlY3RvcnMsIG1vdmUpKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IG9sZFZlY3RvcnMgPSBibG9jay52ZWN0b3JzO1xyXG4gICAgICAgICAgICBibG9jay52ZWN0b3JzID0gYmxvY2suZ2V0QmxvY2tQb3NpdGlvbihtb3ZlKTtcclxuXHJcbiAgICAgICAgICAgIHRoaXMuX21vZGVsLnJlbW92ZUJsb2NrKG9sZFZlY3RvcnMpO1xyXG4gICAgICAgICAgICB0aGlzLl9tb2RlbC5hZGRCbG9jayhibG9jayk7XHJcblxyXG4gICAgICAgICAgICB0aGlzLl92aWV3LnJlbW92ZUJsb2NrKG9sZFZlY3RvcnMpO1xyXG4gICAgICAgICAgICB0aGlzLl92aWV3LnJlbmRlckJsb2NrKGJsb2NrKTtcclxuXHJcbiAgICAgICAgfSBlbHNlIGlmIChtb3ZlLnkgPiAwKSB7XHJcbiAgICAgICAgICAgIHRoaXMuX2NyZWF0ZWRCbG9jayA9IGZhbHNlO1xyXG4gICAgICAgIH1cclxuICAgICAgICBcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIF9jcmVhdGVCbG9jaygpIHtcclxuXHJcbiAgICAgICAgY29uc3QgYmxvY2s6IEJsb2NrID0gdGhpcy5fbW9kZWwuY3JlYXRlQmxvY2soKTtcclxuICAgICAgICBpZihibG9jay52ZWN0b3JzLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgdGhpcy5fdmlldy5yZW5kZXJCbG9jayhibG9jayk7XHJcbiAgICAgICAgICAgIHRoaXMuX2NyZWF0ZWRCbG9jayA9IHRydWU7XHJcbiAgICAgICAgICAgIHJldHVybiBibG9jaztcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8va29uY3p5bXkgZ3JlLCBuaWUgbW96ZW15IHV0d29yenljIG5vd2VnbyBibG9rdSwgZ2R5IGxlbmd0aCBqZXN0IHJvd25hIDBcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIF9zdGFydEdhbWUoKSB7XHJcbiAgICAgICAgXHJcbiAgICAgICAgbGV0IGJsb2NrOiBCbG9jaztcclxuICAgICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigna2V5ZG93bicsIGUgPT4ge1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgaWYoYmxvY2spIHtcclxuICAgICAgICAgICAgICAgIHN3aXRjaChlLmtleUNvZGUpIHtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAzNzogXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX3RyeU1vdmVCbG9jayhibG9jaywgbmV3IFZlY3RvcigtMSwgMCkpO1xyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgXHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAzOTogXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX3RyeU1vdmVCbG9jayhibG9jaywgbmV3IFZlY3RvcigxLCAwKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgXHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHJldHVybiBzZXRJbnRlcnZhbCgoKSA9PiB7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBpZih0aGlzLl9jcmVhdGVkQmxvY2spIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuX3RyeU1vdmVCbG9jayhibG9jaywgbmV3IFZlY3RvcigwLCAxKSk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgIGJsb2NrID0gdGhpcy5fY3JlYXRlQmxvY2soKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgXHJcbiAgICAgICAgfSwgNTAwKTtcclxuXHJcbiAgICAgICAgXHJcbiAgICB9XHJcblxyXG4gICAgaW5pdCgpIHtcclxuXHJcbiAgICAgICAgY29uc3QgYm9hcmQgPSBuZXcgQm9hcmQoMTAsIDIwKTtcclxuICAgICAgICB0aGlzLl9tb2RlbC5zYXZlQm9hcmQoYm9hcmQpO1xyXG4gICAgICAgIHRoaXMuX3ZpZXcucmVuZGVyRW1wdHlUZW1wbGF0ZShib2FyZC5hcmVhKTtcclxuXHJcblxyXG4gICAgICAgIGNvbnN0IHJ1biA9IHRoaXMuX3N0YXJ0R2FtZSgpOyAgICAgIFxyXG4gICAgfVxyXG59IiwiZXhwb3J0IGNvbnN0IERPTSA9IHtcclxuICAgIGJsb2NrVG1wbDogSGFuZGxlYmFycy5jb21waWxlKCBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYmxvY2stdGVtcGxhdGUnKS5pbm5lckhUTUwgKSxcclxuICAgIGJvYXJkOiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuYm9hcmQnKVxyXG59IiwiaW1wb3J0IHsgTW9kZWwgfSBmcm9tICcuL21vZGVsJztcclxuaW1wb3J0IHsgVmlldyB9IGZyb20gJy4vdmlldyc7XHJcbmltcG9ydCB7IENvbnRyb2xsZXIgfSBmcm9tICcuL2NvbnRyb2xsZXInO1xyXG5cclxuY29uc3QgY29udHJvbGxlciA9IG5ldyBDb250cm9sbGVyKG5ldyBNb2RlbCwgbmV3IFZpZXcpO1xyXG5jb250cm9sbGVyLmluaXQoKTtcclxuIiwiaW1wb3J0IHsgQm9hcmQgfSBmcm9tICcuLi9ib2FyZCc7XHJcbmltcG9ydCB7IEJsb2NrLCBPQmxvY2ssIEVtcHR5QmxvY2sgfSBmcm9tICcuLi9ibG9jayc7XHJcbmltcG9ydCB7IFZlY3RvciB9IGZyb20gJy4uL3ZlY3Rvcic7XHJcbmltcG9ydCB7IHRpbWVzIH0gZnJvbSAnLi4vdXNlZnVsLWZ1bmN0aW9ucyc7XHJcblxyXG5leHBvcnQgY2xhc3MgTW9kZWwge1xyXG5cclxuICAgIHByaXZhdGUgX2JvYXJkOiBCb2FyZDtcclxuICAgIHByaXZhdGUgX2Jsb2NrczogQmxvY2tbXTtcclxuICAgIFxyXG4gICAgY29uc3RydWN0b3IoKSB7fVxyXG5cclxuICAgIHByaXZhdGUgX2NoZWNrVmVjdG9yRml0QXJyYXkoYXJyYXk6IGFueVtdW10sIHZlY3RvcjogVmVjdG9yKSB7XHJcbiAgICAgICAgcmV0dXJuIHZlY3Rvci55IDwgYXJyYXkubGVuZ3RoICYmIHZlY3Rvci55ID49IDAgJiYgdmVjdG9yLnggPj0gMCAmJiB2ZWN0b3IueCA8IGFycmF5WzBdLmxlbmd0aDtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIF9jaGVja0lzUG9zaXRpb25GcmVlKHBvc2l0aW9uczogVmVjdG9yW10pIHtcclxuICAgICAgICBjb25zdCB0eXBlT2ZFbXB0eUJsb2NrID0gbmV3IEVtcHR5QmxvY2soKS50eXBlO1xyXG4gICAgICAgIGNvbnN0IGluZGV4OiBudW1iZXIgPSBwb3NpdGlvbnMuZmluZEluZGV4KCh2ZWN0b3I6IFZlY3RvcikgPT4ge1xyXG5cclxuICAgICAgICAgICAgaWYodGhpcy5fY2hlY2tWZWN0b3JGaXRBcnJheSh0aGlzLl9ib2FyZC5hcmVhLCB2ZWN0b3IpKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fYm9hcmQuYXJlYVt2ZWN0b3IueV1bdmVjdG9yLnhdLnZhbHVlLnR5cGUgIT09IHR5cGVPZkVtcHR5QmxvY2s7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICByZXR1cm4gaW5kZXggPT09IC0xO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgX2NoZWNrRnJlZVNwYWNlcyhibG9jazogQmxvY2spIHtcclxuXHJcbiAgICAgICAgY29uc3Qgc3BhY2VzOiBWZWN0b3JbXVtdID0gW107XHJcbiAgICAgICAgY29uc3QgYW1vdW50U3BhY2VzVG9DaGVjazogbnVtYmVyID0gdGhpcy5fYm9hcmQuYXJlYVswXS5sZW5ndGggLSBNYXRoLmZsb29yKGJsb2NrLndpZHRoIC8gMik7XHJcblxyXG4gICAgICAgIHRpbWVzKGFtb3VudFNwYWNlc1RvQ2hlY2ssICh4Om51bWJlcikgPT4ge1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgY29uc3QgYXJlYVZlY3RvcnM6IFZlY3RvcltdID0gYmxvY2suZ2V0QmxvY2tQb3NpdGlvbihuZXcgVmVjdG9yKHgsIDApKTtcclxuICAgICAgICAgICAgaWYodGhpcy5fY2hlY2tJc1Bvc2l0aW9uRnJlZShhcmVhVmVjdG9ycykpIHtcclxuICAgICAgICAgICAgICAgIHNwYWNlcy5wdXNoKGFyZWFWZWN0b3JzKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgcmV0dXJuIHNwYWNlcztcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIF9yYW5kb21WYWx1ZUZyb21BcnJheShhcnJheTogYW55W10pIHsgXHJcbiAgICAgICAgcmV0dXJuIGFycmF5W01hdGguZmxvb3IoIE1hdGgucmFuZG9tKCkgKiBhcnJheS5sZW5ndGggKV07XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBfc2F2ZUJsb2NrKGJsb2NrOiBCbG9jaykge1xyXG5cclxuICAgICAgICBjb25zdCBzcGFjZXM6IFZlY3RvcltdW10gPSB0aGlzLl9jaGVja0ZyZWVTcGFjZXMoYmxvY2spO1xyXG4gICAgICAgIFxyXG4gICAgICAgIGlmKHNwYWNlcy5sZW5ndGggPD0gMCkge1xyXG4gICAgICAgICAgICBibG9jay52ZWN0b3JzID0gW107XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgXHJcbiAgICAgICAgYmxvY2sudmVjdG9ycyA9IHRoaXMuX3JhbmRvbVZhbHVlRnJvbUFycmF5KHNwYWNlcyk7XHJcbiAgICAgICAgdGhpcy5hZGRCbG9jayhibG9jayk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBfZmlsdGVyUHJvcGVyVmVjdG9yVG9Nb3ZlRG93bihwcm9wZXJWZWN0b3JzOiBWZWN0b3JbXSwgdmVjdG9yOiBWZWN0b3IpIHtcclxuXHJcbiAgICAgICAgY29uc3QgcFZlY3RvckluZGV4OiBudW1iZXIgPSBwcm9wZXJWZWN0b3JzLmZpbmRJbmRleCgocFZlY3RvcjogVmVjdG9yKSA9PiBwVmVjdG9yLnggPT09IHZlY3Rvci54KTtcclxuXHJcbiAgICAgICAgaWYocFZlY3RvckluZGV4ID09PSAtMSkge1xyXG5cclxuICAgICAgICAgICAgcHJvcGVyVmVjdG9ycy5wdXNoKG5ldyBWZWN0b3IodmVjdG9yLngsIHZlY3Rvci55KSk7XHJcblxyXG4gICAgICAgIH0gZWxzZSBpZihwcm9wZXJWZWN0b3JzW3BWZWN0b3JJbmRleF0ueSA8IHZlY3Rvci55KSB7XHJcblxyXG4gICAgICAgICAgICBwcm9wZXJWZWN0b3JzW3BWZWN0b3JJbmRleF0ueSA9IHZlY3Rvci55O1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIF9maWx0ZXJQcm9wZXJWZWN0b3JUb01vdmVSaWdodChwcm9wZXJWZWN0b3JzOiBWZWN0b3JbXSwgdmVjdG9yOiBWZWN0b3IpIHtcclxuXHJcbiAgICAgICAgY29uc3QgcFZlY3RvckluZGV4OiBudW1iZXIgPSBwcm9wZXJWZWN0b3JzLmZpbmRJbmRleCgocFZlY3RvcjogVmVjdG9yKSA9PiBwVmVjdG9yLnkgPT09IHZlY3Rvci55KTtcclxuXHJcbiAgICAgICAgaWYocFZlY3RvckluZGV4ID09PSAtMSkge1xyXG5cclxuICAgICAgICAgICAgcHJvcGVyVmVjdG9ycy5wdXNoKG5ldyBWZWN0b3IodmVjdG9yLngsIHZlY3Rvci55KSk7XHJcblxyXG4gICAgICAgIH0gZWxzZSBpZihwcm9wZXJWZWN0b3JzW3BWZWN0b3JJbmRleF0ueCA8IHZlY3Rvci54KSB7XHJcblxyXG4gICAgICAgICAgICBwcm9wZXJWZWN0b3JzW3BWZWN0b3JJbmRleF0ueCA9IHZlY3Rvci54O1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIF9maWx0ZXJQcm9wZXJWZWN0b3JUb01vdmVMZWZ0KHByb3BlclZlY3RvcnM6IFZlY3RvcltdLCB2ZWN0b3I6IFZlY3Rvcikge1xyXG5cclxuICAgICAgICBjb25zdCBwVmVjdG9ySW5kZXg6IG51bWJlciA9IHByb3BlclZlY3RvcnMuZmluZEluZGV4KChwVmVjdG9yOiBWZWN0b3IpID0+IHBWZWN0b3IueSA9PT0gdmVjdG9yLnkpO1xyXG5cclxuICAgICAgICBpZihwVmVjdG9ySW5kZXggPT09IC0xKSB7XHJcblxyXG4gICAgICAgICAgICBwcm9wZXJWZWN0b3JzLnB1c2gobmV3IFZlY3Rvcih2ZWN0b3IueCwgdmVjdG9yLnkpKTtcclxuXHJcbiAgICAgICAgfSBlbHNlIGlmKHByb3BlclZlY3RvcnNbcFZlY3RvckluZGV4XS54ID4gdmVjdG9yLngpIHtcclxuXHJcbiAgICAgICAgICAgIHByb3BlclZlY3RvcnNbcFZlY3RvckluZGV4XS54ID0gdmVjdG9yLng7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgX2ZpbHRlclByb3BlclZlY3RvclRvTW92ZShwcm9wZXJWZWN0b3JzOiBWZWN0b3JbXSwgdmVjdG9yOiBWZWN0b3IsIG1vdmU6IFZlY3Rvcikge1xyXG5cclxuICAgICAgICBpZihtb3ZlLnkgPT09IDEpIHtcclxuICAgICAgICAgICAgdGhpcy5fZmlsdGVyUHJvcGVyVmVjdG9yVG9Nb3ZlRG93bihwcm9wZXJWZWN0b3JzLCB2ZWN0b3IpO1xyXG4gICAgICAgIH0gZWxzZSBpZihtb3ZlLnggPT09IDEpIHtcclxuICAgICAgICAgICAgdGhpcy5fZmlsdGVyUHJvcGVyVmVjdG9yVG9Nb3ZlUmlnaHQocHJvcGVyVmVjdG9ycywgdmVjdG9yKTtcclxuICAgICAgICB9IGVsc2UgaWYobW92ZS54ID09PSAtMSkge1xyXG4gICAgICAgICAgICB0aGlzLl9maWx0ZXJQcm9wZXJWZWN0b3JUb01vdmVMZWZ0KHByb3BlclZlY3RvcnMsIHZlY3Rvcik7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuXHJcblxyXG4gICAgc2F2ZUJvYXJkKGJvYXJkOiBCb2FyZCkge1xyXG5cclxuICAgICAgICB0aGlzLl9ib2FyZCA9IGJvYXJkO1xyXG4gICAgICAgIHRoaXMuX2JvYXJkLmluaXRBcmVhKCk7XHJcbiAgICAgICAgdGhpcy5fYmxvY2tzID0gW1xyXG4gICAgICAgICAgICBuZXcgT0Jsb2NrXHJcbiAgICAgICAgXTtcclxuICAgIH1cclxuXHJcbiAgICBjcmVhdGVCbG9jaygpIHtcclxuICAgICAgICBjb25zdCBibG9ja1NvdXJjZTogQmxvY2sgPSB0aGlzLl9yYW5kb21WYWx1ZUZyb21BcnJheSh0aGlzLl9ibG9ja3MpO1xyXG4gICAgICAgIGNvbnN0IGJsb2NrOiBCbG9jayA9IE9iamVjdC5hc3NpZ24obmV3IEJsb2NrLCBibG9ja1NvdXJjZSk7XHJcbiAgICAgICAgdGhpcy5fc2F2ZUJsb2NrKGJsb2NrKTtcclxuICAgICAgICByZXR1cm4gYmxvY2s7XHJcbiAgICB9XHJcblxyXG4gICAgY2FuRHJvcEJsb2NrKHBvc2l0aW9uczogVmVjdG9yW10sIG1vdmU6IFZlY3Rvcikge1xyXG5cclxuICAgICAgICBjb25zdCBwcm9wZXJWZWN0b3JzOiBWZWN0b3JbXSA9IFtdO1xyXG5cclxuICAgICAgICBwb3NpdGlvbnMuZm9yRWFjaCgodmVjdG9yOiBWZWN0b3IpID0+IHRoaXMuX2ZpbHRlclByb3BlclZlY3RvclRvTW92ZShwcm9wZXJWZWN0b3JzLCB2ZWN0b3IsIG1vdmUpICk7XHJcbiAgICAgICAgXHJcbiAgICAgICAgY29uc3QgZHJvcHBlZFZlY3RvcnMgPSBwcm9wZXJWZWN0b3JzLm1hcCgodmVjdG9yOiBWZWN0b3IpID0+IHZlY3Rvci5wbHVzKG1vdmUpKTtcclxuXHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX2NoZWNrSXNQb3NpdGlvbkZyZWUoZHJvcHBlZFZlY3RvcnMpO1xyXG4gICAgfVxyXG5cclxuICAgIHJlbW92ZUJsb2NrKHZlY3RvcnM6IFZlY3RvcltdKSB7XHJcbiAgICAgICAgdmVjdG9ycy5mb3JFYWNoKCh2ZWN0b3I6IFZlY3RvcikgPT4gdGhpcy5fYm9hcmQuc2V0QXJlYUJsb2NrKHZlY3RvciwgbmV3IEVtcHR5QmxvY2spICk7XHJcbiAgICB9XHJcblxyXG4gICAgYWRkQmxvY2soYmxvY2s6IEJsb2NrKSB7XHJcbiAgICAgICAgYmxvY2sudmVjdG9ycy5mb3JFYWNoKCh2ZWN0b3I6IFZlY3RvcikgPT4gdGhpcy5fYm9hcmQuc2V0QXJlYUJsb2NrKHZlY3RvciwgYmxvY2spICk7XHJcbiAgICB9XHJcblxyXG59IiwiZXhwb3J0IGZ1bmN0aW9uIHRpbWVzKHRpbWVzOiBudW1iZXIsIGZuOiBhbnkpIHtcclxuICAgIFxyXG4gICAgbGV0IG91dHB1dCA9IFwiXCI7XHJcblxyXG4gICAgZm9yKGxldCBpID0gMDsgaSA8IHRpbWVzOyBpKyspIHtcclxuICAgICAgICAgb3V0cHV0ICs9IGZuKGkpOyAgIFxyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiBvdXRwdXQ7XHJcbn0iLCJleHBvcnQgY2xhc3MgVmVjdG9yIHtcclxuXHJcbiAgICBwcml2YXRlIF94OiBudW1iZXI7XHJcbiAgICBwcml2YXRlIF95OiBudW1iZXI7XHJcblxyXG4gICAgY29uc3RydWN0b3IoeDogbnVtYmVyLCB5OiBudW1iZXIpIHtcclxuICAgICAgICB0aGlzLl94ID0geDtcclxuICAgICAgICB0aGlzLl95ID0geTtcclxuICAgIH1cclxuXHJcbiAgICBnZXQgeCgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5feDtcclxuICAgIH1cclxuXHJcbiAgICBnZXQgeSgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5feTtcclxuICAgIH1cclxuXHJcbiAgICBzZXQgeCh4OiBudW1iZXIpIHtcclxuICAgICAgICB0aGlzLl94ID0geDtcclxuICAgIH1cclxuXHJcbiAgICBzZXQgeSh5OiBudW1iZXIpIHtcclxuICAgICAgICB0aGlzLl95ID0geTtcclxuICAgIH1cclxuXHJcbiAgICBwbHVzKHZlY3RvcjogVmVjdG9yKSB7XHJcbiAgICAgICAgcmV0dXJuIG5ldyBWZWN0b3IodGhpcy5feCArIHZlY3Rvci54LCB0aGlzLl95ICsgdmVjdG9yLnkpOyBcclxuICAgIH1cclxuXHJcbiAgICBnZXRJZCgpIHtcclxuICAgICAgICByZXR1cm4gcGFyc2VJbnQoIHRoaXMuX3kudG9TdHJpbmcoKSArIHRoaXMuX3gudG9TdHJpbmcoKSApO1xyXG4gICAgfVxyXG59IiwiaW1wb3J0IHsgRE9NIH0gZnJvbSAnLi4vZG9tLWVsZW1lbnRzJztcclxuaW1wb3J0IHsgdGltZXMgfSBmcm9tICcuLi91c2VmdWwtZnVuY3Rpb25zJztcclxuaW1wb3J0IHsgQmxvY2ssIEVtcHR5QmxvY2sgfSBmcm9tICcuLi9ibG9jayc7XHJcbmltcG9ydCB7IFZlY3RvciB9IGZyb20gJy4uL3ZlY3Rvcic7XHJcblxyXG5leHBvcnQgY2xhc3MgVmlldyB7XHJcblxyXG4gICAgY29uc3RydWN0b3IoKSB7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBfZ2V0QmxvY2tCeUlkKGlkOiBudW1iZXIpIHtcclxuICAgICAgICByZXR1cm4gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2JpZC0nICsgaWQpO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgX2FkZFR5cGVUb0Jsb2NrKGVsOiBIVE1MRWxlbWVudCwgdHlwZTogc3RyaW5nKSB7XHJcbiAgICAgICAgZWwuY2xhc3NOYW1lID0gXCJibG9jayBibG9ja19fXCIgKyB0eXBlO1xyXG4gICAgfVxyXG5cclxuICAgIHJlbmRlckVtcHR5VGVtcGxhdGUoYXJlYTogeyB2YWx1ZTogQmxvY2ssIGlkOiBudW1iZXIgfVtdW10pIHtcclxuXHJcbiAgICAgICAgY29uc3QgZmxhdHRlbmVkID0gYXJlYS5yZWR1Y2UoXHJcbiAgICAgICAgICAgICggc3VtOiB7IHZhbHVlOiBCbG9jaywgaWQ6IG51bWJlciB9W10sIFxyXG4gICAgICAgICAgICAgIHZhbHVlOiB7IHZhbHVlOiBCbG9jaywgaWQ6IG51bWJlciB9W10gKSA9PiBcclxuICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgc3VtLmNvbmNhdCh2YWx1ZSksIFtdIFxyXG4gICAgICAgICk7XHJcblxyXG4gICAgICAgIGNvbnN0IG91dHB1dCA9IGZsYXR0ZW5lZC5yZWR1Y2UoXHJcbiAgICAgICAgICAgICggaHRtbDogc3RyaW5nLCBcclxuICAgICAgICAgICAgICBibG9jazogeyB2YWx1ZTogQmxvY2ssIGlkOiBudW1iZXIgfSApID0+IFxyXG4gICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgaHRtbCArPSBET00uYmxvY2tUbXBsKHtcclxuICAgICAgICAgICAgICAgICAgICB0eXBlOiBibG9jay52YWx1ZS50eXBlLFxyXG4gICAgICAgICAgICAgICAgICAgIGlkOiBibG9jay5pZFxyXG4gICAgICAgICAgICAgICAgfSksIFwiXCJcclxuICAgICAgICApO1xyXG5cclxuICAgICAgICBET00uYm9hcmQuaW5uZXJIVE1MID0gb3V0cHV0O1xyXG4gICAgfVxyXG5cclxuICAgIHJlbmRlckJsb2NrKGJsb2NrOiBCbG9jaykge1xyXG4gICAgICAgIFxyXG4gICAgICAgIGJsb2NrLnZlY3RvcnMuZm9yRWFjaCgodmVjdG9yOiBWZWN0b3IpID0+IHtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGNvbnN0IGlkID0gdmVjdG9yLmdldElkKCk7XHJcbiAgICAgICAgICAgIGNvbnN0IGVsID0gdGhpcy5fZ2V0QmxvY2tCeUlkKGlkKTtcclxuICAgICAgICAgICAgdGhpcy5fYWRkVHlwZVRvQmxvY2soZWwsIGJsb2NrLnR5cGUpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIHJlbW92ZUJsb2NrKHZlY3RvcnM6IFZlY3RvcltdKSB7XHJcblxyXG4gICAgICAgIGNvbnN0IHR5cGVPZkVtcHR5QmxvY2sgPSBuZXcgRW1wdHlCbG9jaygpLnR5cGU7XHJcblxyXG4gICAgICAgIHZlY3RvcnMuZm9yRWFjaCgodmVjdG9yOiBWZWN0b3IpID0+IHtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGNvbnN0IGlkID0gdmVjdG9yLmdldElkKCk7XHJcbiAgICAgICAgICAgIGNvbnN0IGVsID0gdGhpcy5fZ2V0QmxvY2tCeUlkKGlkKTtcclxuICAgICAgICAgICAgdGhpcy5fYWRkVHlwZVRvQmxvY2soZWwsIHR5cGVPZkVtcHR5QmxvY2spO1xyXG5cclxuICAgICAgICB9KTtcclxuICAgIH1cclxufSJdfQ==
